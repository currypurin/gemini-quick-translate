# Gemini Quick Translate

## 概要
英語テキストを選択するだけで即座に翻訳結果をストリーミング表示するChrome拡張です。ページ内に小さなポップアップが現れ、Gemini 2.5 Flashlight APIを利用して自然な日本語訳を届けます。翻訳履歴の閲覧もポップアップから可能です。


## 主な機能
- テキスト選択時に自動ポップアップが表示され、翻訳をワンクリックで開始
- 翻訳結果は受信と同時に順次描画され、進捗メッセージでステータスがわかる
- 翻訳結果をワンクリックでクリップボードにコピー可能（翻訳完了後にコピーボタンが表示）
- オプションページからGemini APIキーを登録すると、その以降の翻訳に利用される
- 翻訳バブルの文字サイズ（11px～80px）と横幅（240px～1200px）をポップアップから調整可能
- 拡張機能アイコンのポップアップから翻訳履歴を閲覧可能（デフォルト2件表示、1～20件まで調整可能）
- 拡張機能のオン・オフをポップアップから切り替え可能

## セットアップ
1. このリポジトリを`git clone`するか、ビルド済みZIP（`dist/`を含む）を展開します。
2. Chromeで`chrome://extensions`を開き、右上の「デベロッパーモード」をオンにします。
3. 画面左上の「パッケージ化されていない拡張機能を読み込む」をクリックし、プロジェクトのフォルダ（`manifest.json`がある階層）を選択します。
4. 拡張一覧に「Gemini Quick Translate」が表示されたら、カード右下の「オプション」をクリックして設定ページに移動します。表示されない場合は、カード内の「詳細」を開いた先にある「オプション」をクリックしてください。

### 開発者向け
- コードを変更する場合は、`npm install`で依存関係を入れ、`npm run dev`（ウォッチ）や`npm run build`（単発ビルド）を実行して`dist/`を更新したうえでコミットしてください。

## 使い方

### テキストを翻訳する
1. 任意のWebページで翻訳したい英語テキストを選択します。
2. 選択範囲の近くに表示されるポップアップで内容を確認し、「翻訳」をクリックします。
3. ステータス欄が「翻訳中…」から「翻訳完了」に変わると全文が表示されます。
4. 翻訳完了後、翻訳ボタンの右に「コピー」ボタンが表示されます。クリックすると翻訳結果がクリップボードにコピーされ、「コピーしました」と表示されます。

### 翻訳履歴を見る
1. Chromeツールバーの拡張機能アイコンをクリックします。
2. ポップアップの「翻訳履歴」セクションに、最近の翻訳が表示されます。
3. +/-ボタンで表示件数を調整できます（1～20件）。
4. 各履歴項目の「翻訳をコピー」ボタンで、その翻訳結果をクリップボードにコピーできます。

## 設定
- **オプションページの開き方**: Chromeツールバーの拡張アイコン → ピン留め済みならアイコンをクリックして「オプション」を選択、または`chrome://extensions`で該当拡張の「詳細」→「オプション」を選びます。
- **APIキー**: オプションページの入力欄にGemini APIキーを入力し「保存」を押すと、そのキーが`chrome.storage.local`に保存されます。保存後は入力欄が空欄に戻るため、必要に応じて別途メモしてください。
- **表示設定**: Chromeツールバーの拡張アイコンをクリックすると、翻訳バブルの文字サイズと横幅、翻訳履歴の表示件数を調整できます。変更は即座に反映され、設定は保存されます。
- **拡張機能のオン・オフ**: ポップアップの「拡張機能」セクションでトグルボタンをクリックすると、翻訳機能の有効/無効を切り替えられます。無効にすると、テキスト選択時に翻訳ポップアップが表示されなくなります。

## 制限事項
- 丁寧語／カジュアルなどのトーン切り替え機能は未実装です。
- 翻訳履歴は最大15件まで保存されます。それを超えると古い履歴から自動的に削除されます。

## トラブルシューティング
- **403エラーが表示される**: APIキーが誤っている、Generative Language APIが有効化されていない、または利用制限に達しています。Google Cloud Consoleでキーと割り当てを確認し、オプションページで再設定してください。
- **Extension context invalidated**: Chromeのサービスワーカーが再起動した際の通知です。拡張を再読み込みし、もう一度翻訳を試してください。

## 要求される権限
- `activeTab`: 現在のタブで選択中のテキストを読み取り、ポップアップを描画するため。
- `scripting`: 必要に応じてコンテンツスクリプトを注入するため。
- `storage`: APIキーを保存するため。
- `contextMenus`（任意）: 右クリックメニューから翻訳を実行するため。
- `clipboardWrite`: 翻訳結果をクリップボードにコピーするため。

## ライセンスと注意事項
- Gemini Flashlight APIの利用にはGoogleの利用規約が適用されます。APIキーの管理や料金発生についてはご自身でご確認ください。
- 本拡張は開発中のプロジェクトです。予告なく仕様が変更される可能性があります。
